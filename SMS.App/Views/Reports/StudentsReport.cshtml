@model SMS.App.ViewModels.ReportVM.Rpt_Student_VM

@{
    ViewData["Title"] = "Student Reports";
    GlobalUI.PageTitle = ViewData["Title"].ToString();
}

@section Styles{

}

<div class="row">
    <div class="col-md-3">
        <div class="row">
            <div class="col-md-12">
                <fieldset class="border-primary p-2 border">
                    <legend class="w-auto text-primary">Students Information</legend>
                    <form id="studentInfoForm" asp-action="StudentsReport" method="post">
                        <div class="form-group row">
                            <label asp-for="AcademicSessionId" class="col-md-4 col-form-label"></label>
                            <div class="col-md-8">
                                <select class="form-control" asp-for="AcademicSessionId" asp-items="Model.AcademicSessionList">
                                    <option selected disabled>Select Academic Session</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label asp-for="AcademicClassId" class="col-md-4 col-form-label"></label>
                            <div class="col-md-8">
                                <select class="form-control" asp-for="AcademicClassId" asp-items="Model.AcademicClassList">
                                    <option selected disabled>Select Academic Class</option>
                                </select>
                                <span asp-validation-for="AcademicClassId" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="report-type" class="col-md-4 col-form-label">Academic Section :</label>
                            <div class="col-md-8">
                                <select class="form-control" id="AcademicSectionId">
                                    <option selected disabled>Select Academic Section</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="offset-7">
                                <button id="viewReportSubmit" type="submit" class="btn btn-primary" name="@Model.ReportType" value="view">View Report</button>
                            </div>
                        </div>
                    </form>
                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12" id="loading" style="display:none">
                <div><h2 class="text-danger"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Please wait while the data is loading...</h2></div>
            </div>
        </div>
    </div>

    @if (Context.Request.Method == "POST")
    {
        <div class="col-md-9" id="iframe-container">
                <div class="row" >
                    <div class="col-md-12 d-flex justify-content-end">
                        <form asp-action="StudentsReportExport" method="get">
                            <div class="btn-group btn-sm mr-2 " role="group" aria-label="First group">
                                <input type="hidden" name="fileName" value="students List" />
                                <button type="submit" name="reportType" value="pdf" class="btn-sm btn btn-danger" data-toggle="tooltip" title="Export PDF" data-placement="left"><i class="fas fa-file-pdf"></i></button>
                                <button type="submit" name="reportType" value="xls" class="btn-sm btn btn-success" data-toggle="tooltip" title="Export xls" data-placement="top"><i class="fas fa-file-excel"></i></button>
                                <button type="submit" name="reportType" value="word" class="btn-sm btn btn-primary" data-toggle="tooltip" title="Export doc" data-placement="top"><i class="fas fa-file-word"></i></button>
                            </div>
                        </form>
                    </div>
                </div>

            <div class="row" style="height:600px;">
                 <iframe id="myIframe" src="@Url.Action("StudentsReportExport", "Reports", new {reportType="pdf" })" style="width: 100%; height: 100%;"></iframe>
            </div>
        </div>
    }
</div>



@section scripts {
    <script>
        $(document).ready(function () {
            $('#loading').hide();
            $('#studentInfoForm').submit(function () {
                $('#loading').show();
            });
            $('#myIframe').on('load', function () {
                $('#loading').hide();
            });
        });


        $('#AcademicClassId').change(function () {
            let id = $('#AcademicClassId option:selected').val();
            let sessionId = $('#AcademicSessionId option:selected').val();

            $.ajax({
                url: "/api/academicsections/getbyclasswithsessionId?classId=" + id + "&sessionId=" + sessionId,
                dataType: "JSON",
                type: "POST",
                cache: false,
                success: function (data) {
                    $('#AcademicSectionId').empty();

                    if (data != null || data != '') {
                        var o = '<option disabled selected>Select Section Name</option>';
                        var o2 = '<option value="0">All Section</option>';
                        $('#AcademicSectionId').append(o);
                        $('#AcademicSectionId').append(o2);
                        $.each(data, function (i, obj) {
                            console.log(obj.name);
                            var op = '<option value="' + obj.id + '">' + obj.name + '</option>';
                            $('#AcademicSectionId').append(op);
                        });
                    }
                    else {
                        var o = '<option disabled selected>Section Not Found</option>';
                        $('#AcademicSectionId').append(o);
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        });
    </script>
}
