@using System.Globalization
@{
    ViewData["Title"] = "Payments Report(Single Student)";
    GlobalUI.PageTitle = ViewData["Title"].ToString();
}

<div class="row">
    <div class="col-md-4">
        <div class="row">
            <div class="col-md-12">
                <form asp-action="StudentPaymentReport" method="post">
                    <fieldset class="border border-info p-2">
                        <legend class="w-auto text-primary">Student(Single) Payment Report Info</legend>

                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">Class Roll</label>
                            <div class="col-sm-9">
                                <input class="form-control" type="number" id="aClassRollId" placeholder="Please input Class roll" />
                            </div>
                        </div>
                        <div class="text-right">
                            <span id="loadReportBtn" class="btn btn-sm btn-info">Load Report</span>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12" id="InvalidForm" style="display:none">
                <div><h2 class="text-danger"> Please Input the field</h2></div>
            </div>
        </div>
    </div>
    <div class="col-md-8" id="iframe-container" style="display:none">
        <div class="row" style="height:600px;">
            <iframe id="myIframe" style="width: 100%; height: 100%;"></iframe>
        </div>
        <div class="row" id="exportOptions" style="display:none">
            <div class="col-md-12 d-flex justify-content-end">
                <form asp-action="StudentPaymentInfoExport" asp-controller="Reports" method="get">
                    <input type="hidden" id="exportClassRollId" name="classRoll" />
                    <div class="btn-group btn-sm mr-2 " role="group" aria-label="First group">
                        <input type="hidden" name="fileName" value="Student Individual Report" />
                        <button type="submit" name="reportType" value="pdf" class="btn-sm btn btn-danger" data-toggle="tooltip" title="Export PDF" data-placement="left"><i class="fas fa-file-pdf"></i></button>
                        <button type="submit" name="reportType" value="xls" class="btn-sm btn btn-success" data-toggle="tooltip" title="Export xls" data-placement="top"><i class="fas fa-file-excel"></i></button>
                        <button type="submit" name="reportType" value="word" class="btn-sm btn btn-primary" data-toggle="tooltip" title="Export doc" data-placement="top"><i class="fas fa-file-word"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-8 text-center" id="loading" style="display:none">
        <div class="d-flex justify-content-center h-100 align-content-center align-items-center">
            <h2 class="text-danger"><span class="spinner-border" role="status" aria-hidden="true"></span> Please wait while the data is loading...</h2>
        </div>
    </div>
</div>



@section Scripts{
    <script>
        $(document).ready(function () {
            $('#loadReportBtn').click(function () {
                let reportType = 'pdf';
                let aClassRoll = '';
                aClassRoll = $('#aClassRollId').val();
                if (aClassRoll.length == 0) {
                    $('#InvalidForm').show();
                    $('#iframe-container').hide();
                    $('#loading').hide();
                }
                else {
                    $('#exportClassRollId').attr('value', aClassRoll);
                    $('#myIframe').attr('src', '/Reports/StudentPaymentInfoExport?reportType=' + reportType + '&classRoll=' + aClassRoll);

                    var iframe = document.getElementById('myIframe');
                    $('#loading').show();
                    $('#iframe-container').hide();
                    $('#InvalidForm').hide();
                    // Attach a load event handler to the iframe
                    iframe.onload = function () {
                        $('#loading').hide();
                        $('#exportOptions').show();
                        $('#iframe-container').show();
                    };

                }
            });
        });

    </script>
}