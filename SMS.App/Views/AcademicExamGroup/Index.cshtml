@{
    GlobalUI.PageTitle = "Exam Groups";
    int sl = 0;
}
@using System.Globalization
@model SMS.App.ViewModels.AcademicVM.AcademicExamGroupVM
    <div class="row">
        <div class="col-md-8">
            @if (Model.AcademicExamGroups.Any())
            {
                <table class="table table-striped table-bordered">
                    <thead class="bg-navy-blue">
                        <tr>
                            <td>#</td>
                            <td>Exam Group Name</td>
                            <td>Exam Type</td>
                            <td>Academic Session</td>
                            <td>Group Status</td>
                            <td class="text-center">Action</td>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.AcademicExamGroups)
                        {
                            <tr>
                                <td>@(++sl)</td>
                                <td>@item.ExamGroupName</td>
                                <td>@item.academicExamType.ExamTypeName</td>
                                <td>@item.AcademicSession.Name</td>
                                <td>
                                @if (item.Status)
                                {
                                    <i class="fas fa-check"></i>
                                }
                                else
                                {
                                    <span>Inactive</span>
                                }
                                </td>
                                <td class="text-center">
                                    <div class="" role="group">
                                        @if (User.IsInRole("Admin") || User.IsInRole("SuperAdmin"))
                                        {
                                            <a  class=" btn-sm  rounded editBtnClass" data-toggle="tooltip" data-id="@item.Id" data-groupName="@item.ExamGroupName" data-examTypeId="@item.academicExamTypeId" data-sessionId="@item.AcademicSessionId" data-monthid="@item.ExamMonthId" data-status="@item.Status" data-placement="top" title="Edit" id="EditBtnId"><i style="cursor:pointer" class="fa fa-edit text-dark"></i> </a>
                                        }
                                        <a  class="btn-sm rounded" data-toggle="tooltip" data-placement="top" title="Details" id="InfoBtnId"><i style="cursor:pointer" class="fa fa-info text-info"></i> </a>
                                        @if (User.IsInRole("SuperAdmin"))
                                        {
                                            <a class="btn-sm rounded deleteBtnClass " data-id="@item.Id" data-toggle="modal" data-target="#DeleteModal" data-placement="right" title="Delete"><i style="cursor:pointer" class="fa fa-trash text-danger"></i> </a>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="row">
                    <div class="col-md-12">
                        <div class="well text-center">
                            <h3>No Data Found <i class="text-primary fa fa-sad-tear"></i></h3>                       
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="col-md-4">
            <div class="card bg-Teal" id="createUpdateCard">
                <div class="card-body p-2">
                    <fieldset class="border-light p-2 border">
                        <legend class="w-auto text-light">Create New Groups</legend>
                        <form asp-action="Create" method="post" id="createUpdateFormId">
                            <input asp-for="Id" type="hidden" />
                            <div class="form-group row">
                                <label asp-for="ExamGroupName" class="col-md-4 col-form-label"></label>
                                <div class="col-md-8">
                                    <input class="form-control" asp-for="ExamGroupName" readonly placeholder="Auto Generated" />
                                    <span asp-validation-for="ExamGroupName" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label asp-for="academicExamTypeId" class="col-md-4 col-form-label"></label>
                                <div class="col-md-8">
                                    <select class="form-control" asp-for="academicExamTypeId" asp-items="Model.ExamTypeList" onchange="createExamName()">
                                        <option selected disabled>-Select Exam Type</option>
                                    </select>
                                    <span asp-validation-for="academicExamTypeId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label asp-for="AcademicSessionId" class="col-md-4 col-form-label"></label>
                                <div class="col-md-8">
                                    <select class="form-control" asp-for="AcademicSessionId" asp-items="Model.AcademicSessionList" onchange="createExamName()">
                                        <option selected disabled>-Select Session-</option>
                                    </select>
                                    <span asp-validation-for="AcademicSessionId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label asp-for="ExamMonthId" class="col-md-4 col-form-label"></label>
                                <div class="col-md-8">
                                    <select class="form-control" asp-for="ExamMonthId" onchange="createExamName()">
                                        <option selected disabled>-Select Exam Month-</option>
                                        @for (int i = 1; i <= 12; i++)
                                        {
                                            <option value="@i">@DateTimeFormatInfo.CurrentInfo.GetMonthName(i)</option>
                                        }
                                    </select>
                                    <span asp-validation-for="ExamMonthId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label asp-for="Status" class="col-md-4 col-form-label"></label>
                                <div class="col-md-1 text-left">
                                    <input asp-for="Status" class="form-control"  />
                                    <span asp-validation-for="Status" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row text-right">
                                <div class="col-md-12 text-right">
                                    <input id="submitBtn" type="submit" value="Create" class="btn btn-sm btn-primary rounded-1" data-toggle="tooltip" data-placement="bottom" title="Create" />
                                </div>
                            </div>
                        </form>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>

<!-- Modal -->
<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="card">
                <div class="card-header">
                    <span class="h4 text-danger">Do you want to Delete this Exam Group?</span>
                </div>
                <div class="card-footer text-center">
                        <form asp-action="Delete" method="post">
                            <input type="hidden" name="Id" id="hiddenExamGroupID" />
                            <button type="submit" class="btn btn-danger btn-sm" id="DeleteConfirmBtn">Delete</button>
                            <button class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
                        </form>
                </div>
            </div>
        </div>
    </div>
</div>


@section scripts{
    <script src="~/js/AlertifyNotify/AlertifyNofify.js"></script>
    <script>
        let deleted = '@TempData["deleted"]';
        let created = '@TempData["created"]';
        let updated = '@TempData["updated"]';
        let failed = '@TempData["error"]';

        function createExamName() {
            let academicExamType = $("#academicExamTypeId option:selected").text();
            let sessionName = $("#AcademicSessionId option:selected").text();
            let monthName = $("#ExamMonthId option:selected").text();
            let examName = academicExamType + " (" + monthName + ") " + sessionName.substr(-4);
            $('#ExamGroupName').val(examName);
        }

        $('#target_div_Create').load('/AcademicExamGroup/Create #AcademicExamGroupCreatePartId');
        //$('#target_div_Edit').load('/AcademicExamGroup/Edit #AcademicExamGroupEditPartId');

        $('.editBtnClass').click(function () {
            let mainCard = document.getElementById('createUpdateCard');
            console.log(mainCard);
            mainCard.classList.remove('bg-Teal');
            mainCard.classList.add('bg-navy-blue');
            mainCard.getElementsByTagName('legend')[0].innerText = "Update Group";
            mainCard.getElementsByTagName('Form')[0].action = "/AcademicExamGroup/Edit";

            document.getElementById('Id').value = $(this).data('id');
            document.getElementById('ExamGroupName').value = $(this).data('groupname');
            $("#academicExamTypeId").val($(this).data('examtypeid')).trigger('change');
            $("#AcademicSessionId").val($(this).data('sessionid')).trigger('change');
            $("#ExamMonthId").val($(this).data('monthid')).trigger('change');
            if ($(this).data('status')=='True') {
                $('#Status').prop('checked', true);
            }
            else {
                $('#Status').prop('checked', false);
            }
            document.getElementById('submitBtn').value = 'Update';
            document.getElementById('submitBtn').classList.remove('btn-primary');
            document.getElementById('submitBtn').classList.add('btn-success');
        });
        $('.deleteBtnClass').click(function () {
            $('#hiddenExamGroupID').val($(this).data('id'));
        });
    </script>
}